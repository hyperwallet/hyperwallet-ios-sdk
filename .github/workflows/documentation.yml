name: Update Documentation

on:
  workflow_dispatch:
  push:
    branches:
      - master
      - feature/**
      - bugfix/**
  pull_request:
    branches:
      - master
      - feature/**
      - bugfix/**

jobs:
  documentation:
    name: Documentation
    strategy:
      matrix:
        include:
          - os: macos-12
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v3

      - name: Generate documentation
        run: make docs

      - name: Push
        run: |
          mkdir ../gh-pages
          cp -r docs/* ../gh-pages/
          cd ../gh-pages

          git config --global user.email "ci-hyperwallet@paypal.com"
          git config --global user.name "ci-hyperwallet"

          # Add branch
          git init
          git remote add origin https://x-access-token:${env.GITHUB_TOKEN}@github.com/hyperwallet/hyperwallet-ios-sdk.git > /dev/null

          git checkout -B gh-pages
          git add -A .
          git commit -m "Documentation updated"

          git push origin gh-pages
